<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="content-language" content="en" />
<title>Untitled Document</title>

<link href="widget.css" rel="stylesheet" />

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
<script src="/PublishedContent/js/jquery-ui-1.8.5.custom.min.js" type="text/javascript"></script>
<script src="termdictWidget-autocomplete.js" type="text/javascript"></script>

<script type="text/javascript">

function bebop() {
    alert('do search');
}

function loadResults(searchTerm) {
    var language;
    var xmlhttp;
    
    if (window.XMLHttpRequest)  {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
    }
    else  {
        // code for IE6, IE5
        xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
    }

    xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)  {
            var AJAXReturned = xmlhttp.responseText;
            var someJSON = eval(AJAXReturned);
            if(someJSON.length == 1) 
            {
                loadDefinition(someJSON[0].id);
            }
            else
            {   
                var terms = '<ul>';
                terms += '<li>' + someJSON.length + ' results found for: <b>' + searchTerm + '</b></li>';
          
                for (x in someJSON) {
                
                    terms += '<li><a href="javascript:;" onclick="loadDefinition(' + 
                    someJSON[x].id + ',\''+ language + '\');">' +  someJSON[x].item + '</a></li>';
                    
                }
                terms += '</ul>';    
                document.getElementById('output').innerHTML=terms;
            }
        }
    }
    if ($('meta[name="content-language"]').attr("content") == "es")
    {
        language = "Spanish";
        xmlhttp.open("GET","/TermDictionary.svc/SearchJSON/Spanish?searchTerm=" + searchTerm ,true);
    }
    else
    {
        language = "English";
        xmlhttp.open("GET","/TermDictionary.svc/SearchJSON/English?searchTerm=" + searchTerm ,true);
    }
    //document.getElementById('search').value = "";
    xmlhttp.send();
}

function loadDefinition(id) {
    var xmlhttp2;
    if (window.XMLHttpRequest)  {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp2=new XMLHttpRequest();
    }
    else  {
        // code for IE6, IE5
        xmlhttp2=new ActiveXObject('Microsoft.XMLHTTP');
    }

    xmlhttp2.onreadystatechange=function() {
        if (xmlhttp2.readyState==4 && xmlhttp2.status==200)  {
            // The added square bracket are to accomidate some 
            // funkiness in the JSON returned - needs to be addresed
            // in the service 
            var AJAXReturned = "[" + xmlhttp2.responseText +"]";
            var someJSON = eval(AJAXReturned);
            
            var definition = '<p><b>' + someJSON[0].item + '</b> ' + someJSON[0].TermDictionaryDetail.TermPronunciation + 
                '</p><p>' + someJSON[0].TermDictionaryDetail.DefinitionHTML + '</p><p>' +
                '<a href="http://www.cancer.gov/dictionary?CdrID=' + someJSON[0].id + '" target="_blank">' +
                'Read this definition on the National Cancer Institute\’s website</a></p>';
                
            document.getElementById('output').innerHTML=definition;
        }
    }
    if ($('meta[name="content-language"]').attr("content") == "es")
        xmlhttp2.open("GET","/TermDictionary.svc/GetTermDictionaryByIdJSON/Spanish?TermId=" + id + "&Audience=Patient", true);
    else
        xmlhttp2.open("GET","/TermDictionary.svc/GetTermDictionaryByIdJSON/English?TermId=" + id + "&Audience=Patient", true);
       
    xmlhttp2.send();
}

function doSearch(e){
    var doit = false;

    if(e!=null)  {
        if (e.keyCode ==13)
            doit = true;
    }
    else
    doit = true;

    if(doit)
    {
        loadResults(document.getElementById('search').value);
    }
}

</script>

</head>

<body>

<div id="container">
	<div class="header">
	  <h1 class="title">NCI Dictionary of Cancer Terms</h1>
	</div>
    
    <div id="form" class="content">
        <div id="searchBlock">
            <input type="text" name="search" id="search" onkeypress="doSearch(event)" />
            <input type="submit" name="Go" id="Go" value="Go" onclick="doSearch(null)" />
        </div>
        <div id="output">
        From the National Cancer Institute: Search for more than 4,000 terms related to cancer and medicine.
        </div>
    </div>
    
    <div class="footer"><a href="http://www.cancer.gov" target="_blank">www.cancer.gov</a> | <a href="#">Disclaimer</a></div>
</div>

</body>
</html>
