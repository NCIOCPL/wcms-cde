<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Term Dictionary Widget Tester</title>
    
<script type="text/javascript">

function loadResults(searchTerm) {
    var xmlhttp;
    if (window.XMLHttpRequest)  {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
    }
    else  {
        // code for IE6, IE5
        xmlhttp=new ActiveXObject('Microsoft.XMLHTTP');
    }

    xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)  {
            var AJAXReturned = xmlhttp.responseText;
            var someJSON = eval(AJAXReturned);
            var terms = '<p>';
            for (x in someJSON) {
            
                terms += '<a href="javascript:;" onclick="loadDefinition(' + 
                someJSON[x].id + ');">' +  someJSON[x].item + '</a></br>';
                
            }
            terms += '</p>';    
            document.getElementById('div_results').innerHTML=terms;
        }
    }
    xmlhttp.open("GET","/TermDictionary.svc/SearchJSON/English?searchTerm=" + searchTerm ,true);
    xmlhttp.send();
}

function loadDefinition(id) {
    var xmlhttp2;
    if (window.XMLHttpRequest)  {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp2=new XMLHttpRequest();
    }
    else  {
        // code for IE6, IE5
        xmlhttp2=new ActiveXObject('Microsoft.XMLHTTP');
    }

    xmlhttp2.onreadystatechange=function() {
        if (xmlhttp2.readyState==4 && xmlhttp2.status==200)  {
            // The added square bracket are to accomidate some 
            // funkiness in the JSON returned - needs to be addresed
            // in the service 
            var AJAXReturned = "[" + xmlhttp2.responseText +"]";
            var someJSON = eval(AJAXReturned);
            
            var definition = '<p><b>' + someJSON[0].item + '</b></br></br>' + 
                someJSON[0].TermDictionaryDetail.DefinitionHTML + '</p>';
                
            document.getElementById('div_definition').innerHTML=definition;
        }
    }
    xmlhttp2.open("GET","/TermDictionary.svc/GetTermDictionaryByIdJSON/English?TermId=" + id + "&Audience=Patient", true);
    xmlhttp2.send();
}
</script>
    
    
</head>
<body>
<div id="div_results"><h2>List of Results Goes Here</h2></div>
<!-- <button type="button" onclick="loadResults('tumor')">Load Results via AJAX</button> -->
<input type="text" name="search" id="search" />
<input type="submit" name="Go" id="Go" value="Go" onclick="loadResults(search.value)" />
<!-- </form> -->

<div id="div_definition"><h2>Definition Goes Here</h2></div>

</body>
</html>

